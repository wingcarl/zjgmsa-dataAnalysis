<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>国际航行船舶数据分析看板</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="${ctxStatic}/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="${ctxStatic}/nickjs/fontawesome/css/all.min.css">
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #0466c8;
            --secondary-color: #0353a4;
            --accent-color: #023e7d;
            --text-color: #001845;
            --highlight-color: #33a1fd;
            --background-color: #f8f9fa;
            --card-bg: rgba(255, 255, 255, 0.9);
            --positive-color: #38b000;
            --negative-color: #d90429;
            --grid-line: rgba(4, 102, 200, 0.2);
            --chart-colors: #64B5F6, #81C784, #FFB74D, #E57373, #BA68C8, #4DD0E1;
        }

        body {
            background-color: var(--background-color);
            background-image: linear-gradient(to bottom, rgba(4, 102, 200, 0.05), rgba(1, 22, 56, 0.1));
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 16px;
        }

        .main-header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--accent-color);
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .main-title {
            text-align: center;
            font-size: 28px;
            font-weight: 600;
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }

        .chart-container {
            height: 400px;
            margin: 20px 0 30px;
            border-radius: 8px;
            background-color: var(--card-bg);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 15px;
        }

        .data-card {
            border: 1px solid rgba(4, 102, 200, 0.2);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            background-color: var(--card-bg);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .data-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .data-card .label {
            color: var(--accent-color);
            font-weight: 600;
            font-size: 1.1rem;
            padding: 0;
            display: block;
            margin-bottom: 5px;
        }

        .data-card .value {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .date-range-picker {
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .date-range-picker input {
            margin: 0 15px;
            border-radius: 4px;
            border: 1px solid var(--grid-line);
            font-size: 1.1rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--secondary-color);
            font-weight: 600;
            padding: 8px 20px;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .btn-primary:hover {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .filter-section {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .filter-label {
            font-weight: 600;
            margin-right: 10px;
            color: var(--accent-color);
        }

        .filter-select {
            border: 1px solid var(--grid-line);
            border-radius: 4px;
            padding: 5px 10px;
            margin-right: 15px;
        }

        .charts-section {
            background-color: rgba(248, 249, 250, 0.5);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .charts-title {
            color: var(--primary-color);
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 30px;
            text-align: center;
        }

        .icon-box {
            margin-right: 8px;
            color: var(--primary-color);
        }

        /* 返回主页按钮样式 */
        .btn-back-home {
            background-color: rgba(255, 255, 255, 0.9);
            color: var(--primary-color);
            border: 2px solid white;
            border-radius: 50px;
            padding: 8px 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }
        
        .btn-back-home:hover {
            background-color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            color: var(--accent-color);
        }

        @media (max-width: 768px) {
            .date-range-picker {
                flex-direction: column;
                align-items: stretch;
            }

            .date-range-picker input {
                margin: 10px 0;
                width: 100%;
            }

            .btn-primary {
                width: 100%;
                margin-top: 10px;
            }

            .chart-container {
                height: 300px;
            }

            /* 修改卡片布局，在平板设备上保持一行三个 */
            .col-md-4 {
                width: 33.333333%;
                float: left;
            }
            
            .data-card {
                margin-bottom: 15px;
            }
            
            .data-card .value {
                font-size: 1.8em;
            }
            
            .data-card .label {
                font-size: 0.9rem;
            }

            .main-header .container .d-flex {
                flex-direction: column;
                text-align: center;
            }
            
            .btn-back-home {
                margin-bottom: 10px;
            }
            
            .main-title {
                font-size: 22px;
                margin: 10px 0;
            }
        }
        
        /* 添加手机设备的媒体查询 */
        @media (max-width: 576px) {
            .col-md-4 {
                width: 100%;
                float: none;
            }
            
            .data-card {
                margin-bottom: 15px;
            }
            
            .data-card .value {
                font-size: 1.6em;
            }
            
            .data-card .label {
                font-size: 0.85rem;
            }
        }
    </style>
</head>

<body>
<div class="main-header">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <a href="${ctx}/shiplog/shipPortLog/list" class="btn btn-back-home">
                <i class="fa fa-list"></i> 返回列表
            </a>
            <h1 class="main-title"><i class="fas fa-ship icon-box"></i>国际航行船舶数据分析看板</h1>
            <div class="date-range">
                <!-- 日期选择器 -->
                <div class="date-range-picker">
                    <label for="startDate" style="margin-right: 10px; line-height: 38px; font-weight: 600; font-size: 1.1rem;">
                        <i class="far fa-calendar-alt icon-box"></i>开始日期：
                    </label>
                    <input type="date" id="startDate" class="form-control" style="width: auto;">

                    <label for="endDate" style="margin: 0 10px 0 20px; line-height: 38px; font-weight: 600; font-size: 1.1rem;">
                        <i class="far fa-calendar-alt icon-box"></i>结束日期：
                    </label>
                    <input type="date" id="endDate" class="form-control" style="width: auto;">

                    <button type="button" id="fetchDataButton" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> 查询数据
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <!-- 数据卡片区域 -->
    <div class="row">
        <div class="col-md-4">
            <div class="data-card">
                <div class="label"><i class="fas fa-sign-in-alt icon-box"></i>进港查验数量</div>
                <div class="value" id="in-port-count-value">0</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="data-card">
                <div class="label"><i class="fas fa-sign-out-alt icon-box"></i>出港查验数量</div>
                <div class="value" id="out-port-count-value">0</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="data-card">
                <div class="label"><i class="fas fa-boxes icon-box"></i>装卸货量(万吨)</div>
                <div class="value" id="cargo-tonnage-value">0</div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="data-card">
                <div class="label"><i class="fas fa-anchor icon-box"></i>往来港口数量</div>
                <div class="value" id="port-count-value">0</div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="data-card">
                <div class="label"><i class="fas fa-flag icon-box"></i>船籍港数量</div>
                <div class="value" id="registry-port-count-value">0</div>
            </div>
        </div>
    </div>

    <!-- 图表筛选条件 -->
    <div class="filter-section">
        <div class="row">
            <div class="col-md-3">
                <span class="filter-label"><i class="fas fa-filter icon-box"></i>时间间隔：</span>
                <select id="time-interval-filter" class="filter-select">
                    <option value="day">按日</option>
                    <option value="week">按周</option>
                    <option value="month">按月</option>
                    <option value="year">按年</option>
                </select>
            </div>
            <div class="col-md-3">
                <span class="filter-label"><i class="fas fa-filter icon-box"></i>码头：</span>
                <select id="berthing-location-filter" class="filter-select">
                    <option value="all">全部</option>
                </select>
            </div>
            <div class="col-md-3">
                <span class="filter-label"><i class="fas fa-filter icon-box"></i>船舶类型：</span>
                <select id="ship-category-filter" class="filter-select">
                    <option value="all">全部</option>
                </select>
            </div>
            <div class="col-md-3">
                <button type="button" id="applyFiltersButton" class="btn btn-primary">
                    <i class="fas fa-search"></i> 应用筛选
                </button>
            </div>
        </div>
    </div>

    <!-- 时间趋势图 -->
    <div class="charts-section">
        <h5 class="charts-title"><i class="fas fa-chart-line icon-box"></i>国际航行船舶进出港时间趋势</h5>
        <div class="row">
            <div class="col-md-12">
                <div id="trend-chart" class="chart-container"></div>
            </div>
        </div>
    </div>

    <!-- 码头船舶数量和货量统计 -->
    <div class="row">
        <!-- 各码头船舶数量 -->
        <div class="col-md-6">
            <div class="charts-section">
                <h5 class="charts-title"><i class="fas fa-anchor icon-box"></i>各码头船舶数量</h5>
                <div id="berthing-location-chart" class="chart-container"></div>
            </div>
        </div>
        <!-- 各码头装卸货量 -->
        <div class="col-md-6">
            <div class="charts-section">
                <h5 class="charts-title"><i class="fas fa-boxes icon-box"></i>各码头装卸货量(万吨)</h5>
                <div id="berthing-location-cargo-chart" class="chart-container"></div>
            </div>
        </div>
    </div>

    <!-- 船舶类型分布 -->
    <div class="row">
        <div class="col-md-12">
            <div class="charts-section">
                <h5 class="charts-title"><i class="fas fa-ship icon-box"></i>船舶类型分布</h5>
                <div id="ship-category-chart" class="chart-container"></div>
            </div>
        </div>
    </div>

    <!-- 来往港口分析 -->
    <div class="row">
        <!-- 来往港口数量统计 -->
        <div class="col-md-6">
            <div class="charts-section">
                <h5 class="charts-title"><i class="fas fa-map-marker-alt icon-box"></i>来往港口数量分析</h5>
                <div id="previous-next-port-chart" class="chart-container"></div>
            </div>
        </div>
        <!-- 来往港口装卸货量统计 -->
        <div class="col-md-6">
            <div class="charts-section">
                <h5 class="charts-title"><i class="fas fa-boxes icon-box"></i>来往港口装卸货量分析(万吨)</h5>
                <div id="previous-next-port-cargo-chart" class="chart-container"></div>
            </div>
        </div>
    </div>

    <!-- 船籍港分析 -->
    <div class="row">
        <div class="col-md-12">
            <div class="charts-section">
                <h5 class="charts-title"><i class="fas fa-flag icon-box"></i>船籍港分析</h5>
                <div id="port-of-registry-chart" class="chart-container"></div>
            </div>
        </div>
    </div>

    <!-- 航运公司分析 -->
    <div class="row">
        <!-- 船舶所有人统计 -->
        <div class="col-md-6">
            <div class="charts-section">
                <h5 class="charts-title"><i class="fas fa-building icon-box"></i>船舶所有人分析</h5>
                <div id="ship-owner-chart" class="chart-container"></div>
            </div>
        </div>
        <!-- 船舶经营人统计 -->
        <div class="col-md-6">
            <div class="charts-section">
                <h5 class="charts-title"><i class="fas fa-user-tie icon-box"></i>船舶经营人分析</h5>
                <div id="ship-operator-chart" class="chart-container"></div>
            </div>
        </div>
    </div>
</div>

<!-- jQuery 和 ECharts -->
<script src="${ctxStatic}/jquery/jquery-3.7.0.js"></script>
<script src="${ctxStatic}/nickjs/echarts.js"></script>
<!-- Scripts -->
<script src="${ctxStatic}/bootstrap/js/bootstrap.js"></script>
<script src="${ctxStatic}/nickjs/sweetalert2.min.js"></script>

<script>
    $(document).ready(function() {
        // 初始化图表实例
        var trendChart = echarts.init(document.getElementById('trend-chart'));
        var berthingLocationChart = echarts.init(document.getElementById('berthing-location-chart'));
        var berthingLocationCargoChart = echarts.init(document.getElementById('berthing-location-cargo-chart'));
        var shipCategoryChart = echarts.init(document.getElementById('ship-category-chart'));
        var previousNextPortChart = echarts.init(document.getElementById('previous-next-port-chart'));
        var previousNextPortCargoChart = echarts.init(document.getElementById('previous-next-port-cargo-chart'));
        var portOfRegistryChart = echarts.init(document.getElementById('port-of-registry-chart'));
        var shipOwnerChart = echarts.init(document.getElementById('ship-owner-chart'));
        var shipOperatorChart = echarts.init(document.getElementById('ship-operator-chart'));

        // 计算默认日期范围（上周五至本周四）
        function calculateDefaultDateRange() {
            var today = new Date();
            var dayOfWeek = today.getDay(); // 0是周日，1-6是周一到周六
            
            var endDate = new Date(today);
            var startDate = new Date(today);
            
            // 如果今天是周五(5)或周六(6)，则结束日期是本周四
            if (dayOfWeek >= 5) {
                endDate.setDate(today.getDate() - (dayOfWeek - 4));
            } else {
                // 否则结束日期是上周四
                endDate.setDate(today.getDate() - (dayOfWeek + 3));
            }
            
            // 开始日期是结束日期往前推6天（周五）
            startDate = new Date(endDate);
            startDate.setDate(endDate.getDate() - 6);
            
            return {
                start: startDate.toISOString().slice(0, 10),
                end: endDate.toISOString().slice(0, 10)
            };
        }

        // 设置默认日期为指定范围
        var defaultDates = calculateDefaultDateRange();
        $('#startDate').val(defaultDates.start);
        $('#endDate').val(defaultDates.end);

        // 初始化筛选选项
        loadFilterOptions();

        // 获取并展示数据
        fetchAndDisplayData();

        // 绑定查询按钮点击事件
        $('#fetchDataButton').on('click', function() {
            fetchAndDisplayData();
        });

        // 绑定筛选按钮点击事件
        $('#applyFiltersButton').on('click', function() {
            loadChartData();
        });

        // 窗口大小变化时调整图表大小
        $(window).on('resize', function() {
            trendChart.resize();
            berthingLocationChart.resize();
            berthingLocationCargoChart.resize();
            shipCategoryChart.resize();
            previousNextPortChart.resize();
            previousNextPortCargoChart.resize();
            portOfRegistryChart.resize();
            shipOwnerChart.resize();
            shipOperatorChart.resize();
        });

        // 加载筛选选项
        function loadFilterOptions() {
            $.ajax({
                url: '${ctx}/shiplog/shipPortLog/filterOptions',
                type: 'GET',
                success: function(response) {
                    if (response.success) {
                        // 填充码头选项
                        var berthingLocationSelect = $('#berthing-location-filter');
                        berthingLocationSelect.empty().append('<option value="all">全部</option>');
                        $.each(response.berthingLocations, function(index, location) {
                            if (location && location.trim() !== '') {
                                berthingLocationSelect.append('<option value="' + location + '">' + location + '</option>');
                            }
                        });

                        // 填充船舶类型选项
                        var shipCategorySelect = $('#ship-category-filter');
                        shipCategorySelect.empty().append('<option value="all">全部</option>');
                        $.each(response.shipCategories, function(index, category) {
                            if (category && category.trim() !== '') {
                                shipCategorySelect.append('<option value="' + category + '">' + category + '</option>');
                            }
                        });
                    }
                },
                error: function(xhr, status, error) {
                    console.error('加载筛选选项失败：' + error);
                }
            });
        }

        // 获取并展示数据的函数
        function fetchAndDisplayData() {
            var startDate = $('#startDate').val();
            var endDate = $('#endDate').val();
            
            if (!startDate || !endDate) {
                Swal.fire({
                    icon: 'warning',
                    title: '提示',
                    text: '请选择开始日期和结束日期！'
                });
                return;
            }
            
            if (startDate > endDate) {
                Swal.fire({
                    icon: 'warning',
                    title: '提示',
                    text: '开始日期不能大于结束日期！'
                });
                return;
            }

            // 显示加载状态
            $('#in-port-count-value').text('加载中...');
            $('#out-port-count-value').text('加载中...');
            $('#cargo-tonnage-value').text('加载中...');
            $('#port-count-value').text('加载中...');
            $('#registry-port-count-value').text('加载中...');

            // 发送AJAX请求获取基础统计数据
            $.ajax({
                url: '${ctx}/shiplog/shipPortLog/analysisData',
                type: 'GET',
                data: {
                    startDate: startDate,
                    endDate: endDate
                },
                success: function(response) {
                    if (response.success) {
                        var data = response.data;
                        
                        // 更新卡片数据
                        $('#in-port-count-value').text(data.inPortCount || 0);
                        $('#out-port-count-value').text(data.outPortCount || 0);
                        $('#cargo-tonnage-value').text(formatNumber((data.totalCargoTonnage || 0) / 10000));
                        $('#port-count-value').text(data.portCount || 0);
                        $('#registry-port-count-value').text(data.registryPortCount || 0);
                        
                        // 加载图表数据
                        loadChartData();
                        
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: '错误',
                            text: response.message || '获取数据失败！'
                        });
                        
                        // 重置为0
                        resetCardValues();
                    }
                },
                error: function(xhr, status, error) {
                    Swal.fire({
                        icon: 'error',
                        title: '错误',
                        text: '网络请求失败：' + error
                    });
                    
                    // 重置为0
                    resetCardValues();
                }
            });
        }

        // 重置卡片值
        function resetCardValues() {
            $('#in-port-count-value').text('0');
            $('#out-port-count-value').text('0');
            $('#cargo-tonnage-value').text('0');
            $('#port-count-value').text('0');
            $('#registry-port-count-value').text('0');
        }

        // 加载图表数据
        function loadChartData() {
            var startDate = $('#startDate').val();
            var endDate = $('#endDate').val();
            var timeInterval = $('#time-interval-filter').val();
            var berthingLocation = $('#berthing-location-filter').val();
            var shipCategory = $('#ship-category-filter').val();

            var params = {
                startDate: startDate,
                endDate: endDate,
                timeInterval: timeInterval,
                berthingLocation: berthingLocation,
                shipCategory: shipCategory
            };

            // 加载时间趋势图
            loadTrendChart(params);
            
            // 加载码头统计图
            loadBerthingLocationChart(params);
            
            // 加载码头货量统计图
            loadBerthingLocationCargoChart(params);
            
            // 加载船舶类型统计图
            loadShipCategoryChart(params);
            
            // 加载来往港口统计图
            loadPreviousNextPortChart(params);
            
            // 加载来往港口货量统计图
            loadPreviousNextPortCargoChart(params);
            
            // 加载船籍港统计图
            loadPortOfRegistryChart(params);
            
            // 加载船舶所有人统计图
            loadShipOwnerChart(params);
            
            // 加载船舶经营人统计图
            loadShipOperatorChart(params);
        }

        // 加载时间趋势图
        function loadTrendChart(params) {
            $.ajax({
                url: '${ctx}/shiplog/shipPortLog/trendData',
                type: 'GET',
                data: params,
                success: function(response) {
                    if (response.success) {
                        var data = response.data;
                        var xAxisData = [];
                        var inPortData = [];
                        var outPortData = [];

                        $.each(data, function(index, item) {
                            xAxisData.push(item.timeDisplay);
                            inPortData.push(item.inPortCount || 0);
                            outPortData.push(item.outPortCount || 0);
                        });

                        var option = {
                            title: {
                                text: '国际航行船舶进出港时间趋势',
                                left: 'center'
                            },
                            tooltip: {
                                trigger: 'axis'
                            },
                            legend: {
                                data: ['进港', '出港'],
                                top: 30
                            },
                            xAxis: {
                                type: 'category',
                                data: xAxisData
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [
                                {
                                    name: '进港',
                                    type: 'line',
                                    data: inPortData,
                                    itemStyle: { color: '#64B5F6' }
                                },
                                {
                                    name: '出港',
                                    type: 'line',
                                    data: outPortData,
                                    itemStyle: { color: '#81C784' }
                                }
                            ]
                        };

                        trendChart.setOption(option);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('加载时间趋势图失败：' + error);
                }
            });
        }

        // 加载码头船舶数量统计图
        function loadBerthingLocationChart(params) {
            $.ajax({
                url: '${ctx}/shiplog/shipPortLog/berthingLocationStats',
                type: 'GET',
                data: params,
                success: function(response) {
                    if (response.success) {
                        var data = response.data;
                        var xAxisData = [];
                        var seriesData = [];

                        $.each(data, function(index, item) {
                            xAxisData.push(item.berthingLocation);
                            seriesData.push(item.shipCount || 0);
                        });

                        var option = {
                            title: {
                                text: '各码头船舶数量',
                                left: 'center'
                            },
                            tooltip: {
                                trigger: 'axis'
                            },
                            xAxis: {
                                type: 'category',
                                data: xAxisData,
                                axisLabel: {
                                    rotate: 45
                                }
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [{
                                type: 'bar',
                                data: seriesData,
                                itemStyle: { color: '#FFB74D' }
                            }]
                        };

                        berthingLocationChart.setOption(option);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('加载码头统计图失败：' + error);
                }
            });
        }

        // 加载码头装卸货量统计图
        function loadBerthingLocationCargoChart(params) {
            $.ajax({
                url: '${ctx}/shiplog/shipPortLog/berthingLocationCargoStats',
                type: 'GET',
                data: params,
                success: function(response) {
                    if (response.success) {
                        var data = response.data;
                        var xAxisData = [];
                        var seriesData = [];

                        $.each(data, function(index, item) {
                            xAxisData.push(item.berthingLocation);
                            seriesData.push((parseFloat(item.cargoTonnage) || 0) / 10000);
                        });

                        var option = {
                            title: {
                                text: '各码头装卸货量',
                                left: 'center'
                            },
                            tooltip: {
                                trigger: 'axis',
                                formatter: function(params) {
                                    return params[0].name + '<br/>' + 
                                           params[0].seriesName + ': ' + formatNumber(params[0].value) + ' 万吨';
                                }
                            },
                            xAxis: {
                                type: 'category',
                                data: xAxisData,
                                axisLabel: {
                                    rotate: 45
                                }
                            },
                            yAxis: {
                                type: 'value',
                                axisLabel: {
                                    formatter: function(value) {
                                        return formatNumber(value) + ' 万吨';
                                    }
                                }
                            },
                            series: [{
                                name: '装卸货量',
                                type: 'bar',
                                data: seriesData,
                                itemStyle: { color: '#E57373' }
                            }]
                        };

                        berthingLocationCargoChart.setOption(option);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('加载码头货量统计图失败：' + error);
                }
            });
        }

        // 加载船舶类型统计图
        function loadShipCategoryChart(params) {
            $.ajax({
                url: '${ctx}/shiplog/shipPortLog/shipCategoryStats',
                type: 'GET',
                data: params,
                success: function(response) {
                    if (response.success) {
                        var data = response.data;
                        var seriesData = [];

                        $.each(data, function(index, item) {
                            seriesData.push({
                                name: item.shipCategory,
                                value: item.shipCount || 0
                            });
                        });

                        var option = {
                            title: {
                                text: '船舶类型分布',
                                left: 'center'
                            },
                            tooltip: {
                                trigger: 'item',
                                formatter: '{a} <br/>{b}: {c} ({d}%)'
                            },
                            legend: {
                                orient: 'vertical',
                                left: 'left',
                                top: 'middle'
                            },
                            series: [{
                                name: '船舶类型',
                                type: 'pie',
                                radius: '50%',
                                data: seriesData,
                                emphasis: {
                                    itemStyle: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                    }
                                }
                            }]
                        };

                        shipCategoryChart.setOption(option);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('加载船舶类型统计图失败：' + error);
                }
            });
        }

        // 加载来往港口统计图
        function loadPreviousNextPortChart(params) {
            $.ajax({
                url: '${ctx}/shiplog/shipPortLog/previousNextPortStats',
                type: 'GET',
                data: params,
                success: function(response) {
                    if (response.success) {
                        var data = response.data;
                        var xAxisData = [];
                        var seriesData = [];

                        // 默认显示前20个，支持数据缩放
                        $.each(data.slice(0, 20), function(index, item) {
                            xAxisData.push(item.portName);
                            seriesData.push(item.shipCount || 0);
                        });

                        var option = {
                            title: {
                                text: '来往港口数量分析',
                                left: 'center'
                            },
                            tooltip: {
                                trigger: 'axis'
                            },
                            dataZoom: [
                                {
                                    type: 'slider',
                                    show: true,
                                    xAxisIndex: [0],
                                    start: 0,
                                    end: 100
                                }
                            ],
                            xAxis: {
                                type: 'category',
                                data: xAxisData,
                                axisLabel: {
                                    rotate: 45
                                }
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [{
                                type: 'bar',
                                data: seriesData,
                                itemStyle: { color: '#BA68C8' }
                            }]
                        };

                        previousNextPortChart.setOption(option);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('加载来往港口统计图失败：' + error);
                }
            });
        }

        // 加载来往港口装卸货量统计图
        function loadPreviousNextPortCargoChart(params) {
            $.ajax({
                url: '${ctx}/shiplog/shipPortLog/previousNextPortCargoStats',
                type: 'GET',
                data: params,
                success: function(response) {
                    if (response.success) {
                        var data = response.data;
                        var xAxisData = [];
                        var seriesData = [];

                        // 默认显示前20个，支持数据缩放
                        $.each(data.slice(0, 20), function(index, item) {
                            xAxisData.push(item.portName);
                            seriesData.push((parseFloat(item.cargoTonnage) || 0) / 10000);
                        });

                        var option = {
                            title: {
                                text: '来往港口装卸货量分析',
                                left: 'center'
                            },
                            tooltip: {
                                trigger: 'axis',
                                formatter: function(params) {
                                    return params[0].name + '<br/>' + 
                                           params[0].seriesName + ': ' + formatNumber(params[0].value) + ' 万吨';
                                }
                            },
                            dataZoom: [
                                {
                                    type: 'slider',
                                    show: true,
                                    xAxisIndex: [0],
                                    start: 0,
                                    end: 100
                                }
                            ],
                            xAxis: {
                                type: 'category',
                                data: xAxisData,
                                axisLabel: {
                                    rotate: 45
                                }
                            },
                            yAxis: {
                                type: 'value',
                                axisLabel: {
                                    formatter: function(value) {
                                        return formatNumber(value) + ' 万吨';
                                    }
                                }
                            },
                            series: [{
                                name: '装卸货量',
                                type: 'bar',
                                data: seriesData,
                                itemStyle: { color: '#4DD0E1' }
                            }]
                        };

                        previousNextPortCargoChart.setOption(option);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('加载来往港口货量统计图失败：' + error);
                }
            });
        }

        // 加载船籍港统计图
        function loadPortOfRegistryChart(params) {
            $.ajax({
                url: '${ctx}/shiplog/shipPortLog/portOfRegistryStats',
                type: 'GET',
                data: params,
                success: function(response) {
                    if (response.success) {
                        var data = response.data;
                        var xAxisData = [];
                        var seriesData = [];

                        // 默认显示前20个，支持数据缩放
                        $.each(data.slice(0, 20), function(index, item) {
                            xAxisData.push(item.registryPort);
                            seriesData.push(item.shipCount || 0);
                        });

                        var option = {
                            title: {
                                text: '船籍港分析',
                                left: 'center'
                            },
                            tooltip: {
                                trigger: 'axis'
                            },
                            dataZoom: [
                                {
                                    type: 'slider',
                                    show: true,
                                    xAxisIndex: [0],
                                    start: 0,
                                    end: 100
                                }
                            ],
                            xAxis: {
                                type: 'category',
                                data: xAxisData,
                                axisLabel: {
                                    rotate: 45
                                }
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [{
                                type: 'bar',
                                data: seriesData,
                                itemStyle: { color: '#64B5F6' }
                            }]
                        };

                        portOfRegistryChart.setOption(option);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('加载船籍港统计图失败：' + error);
                }
            });
        }

        // 加载船舶所有人统计图
        function loadShipOwnerChart(params) {
            $.ajax({
                url: '${ctx}/shiplog/shipPortLog/shipOwnerStats',
                type: 'GET',
                data: params,
                success: function(response) {
                    if (response.success) {
                        var data = response.data;
                        var xAxisData = [];
                        var seriesData = [];

                        // 默认显示前20个，支持数据缩放
                        $.each(data.slice(0, 20), function(index, item) {
                            xAxisData.push(item.ownerName);
                            seriesData.push(item.shipCount || 0);
                        });

                        var option = {
                            title: {
                                text: '船舶所有人分析',
                                left: 'center'
                            },
                            tooltip: {
                                trigger: 'axis'
                            },
                            dataZoom: [
                                {
                                    type: 'slider',
                                    show: true,
                                    xAxisIndex: [0],
                                    start: 0,
                                    end: 100
                                }
                            ],
                            xAxis: {
                                type: 'category',
                                data: xAxisData,
                                axisLabel: {
                                    rotate: 45
                                }
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [{
                                type: 'bar',
                                data: seriesData,
                                itemStyle: { color: '#81C784' }
                            }]
                        };

                        shipOwnerChart.setOption(option);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('加载船舶所有人统计图失败：' + error);
                }
            });
        }

        // 加载船舶经营人统计图
        function loadShipOperatorChart(params) {
            $.ajax({
                url: '${ctx}/shiplog/shipPortLog/shipOperatorStats',
                type: 'GET',
                data: params,
                success: function(response) {
                    if (response.success) {
                        var data = response.data;
                        var xAxisData = [];
                        var seriesData = [];

                        // 默认显示前20个，支持数据缩放
                        $.each(data.slice(0, 20), function(index, item) {
                            xAxisData.push(item.operatorName);
                            seriesData.push(item.shipCount || 0);
                        });

                        var option = {
                            title: {
                                text: '船舶经营人分析',
                                left: 'center'
                            },
                            tooltip: {
                                trigger: 'axis'
                            },
                            dataZoom: [
                                {
                                    type: 'slider',
                                    show: true,
                                    xAxisIndex: [0],
                                    start: 0,
                                    end: 100
                                }
                            ],
                            xAxis: {
                                type: 'category',
                                data: xAxisData,
                                axisLabel: {
                                    rotate: 45
                                }
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [{
                                type: 'bar',
                                data: seriesData,
                                itemStyle: { color: '#FFB74D' }
                            }]
                        };

                        shipOperatorChart.setOption(option);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('加载船舶经营人统计图失败：' + error);
                }
            });
        }

        // 格式化数字，添加千分位分隔符
        function formatNumber(num) {
            if (num === null || num === undefined) return '0';
            return parseFloat(num).toLocaleString('zh-CN', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            });
        }
    });
</script>

</body>
</html> 